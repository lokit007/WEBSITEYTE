<!DOCTYPE html>
<html>
<head>
<title>Google Maps API v3 Example: Distance Matrix</title>
<script
	src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>

<style>
body {
	margin: 20px;
	font-family: courier, sans-serif;
	font-size: 12px;
}

#map {
	height: 480px;
	width: 640px;
	border: solid thin #333;
	margin-top: 20px;
}
</style>

<script>
	var map;
	var geocoder;
	var bounds = new google.maps.LatLngBounds();
	var markersArray = [];

	var origin1 = new google.maps.LatLng(20.9875830, 105.8316770); // Địa Điểm thứ nhất theo tọa độ
	var origin2 = 'Định công, Hà Nội'; // Địa điểm đi thứ hai
	var destinationA = 'Hai Bà Trưng, Hà Nội, Việt Nam'; // Địa điểm đến thứ nhất
	var destinationB = 'Cầu Giấy, Quan Hoa, Hà Nội, Việt Nam'; // Địa điểm đến thứ hai

	// Icon địa điểm đến hiển thị trên bản đồ
	var destinationIcon = 'https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=D|FF0000|000000';
	// Icon địa điểm đi hiển thị trên bản đồ
	var originIcon = 'https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=O|FFFF00|000000';

	// Hàm khởi tạo bản đồ
	function initialize() {
		var opts = {
			center : new google.maps.LatLng(20.9875830, 105.8316770), // Kinh độ/ Vĩ độ trung tâm của bản đồ
			zoom : 10,
			mapTypeId : google.maps.MapTypeId.ROADMAP
		};
		map = new google.maps.Map(document.getElementById('map'), opts);
		geocoder = new google.maps.Geocoder();
	}

	// hàm tính toán và gọi service Google javascript API
	function calculateDistances() {
		// Khởi tạo Distance matrix service
		var service = new google.maps.DistanceMatrixService();
		service.getDistanceMatrix({
			origins : [ origin1, origin2 ],
			destinations : [ destinationA, destinationB ],
			travelMode : google.maps.TravelMode.DRIVING,
			unitSystem : google.maps.UnitSystem.METRIC,
			avoidHighways : false,
			avoidTolls : false
		}, callback);
	}

	function calculateDistances2() {
		// Khởi tạo Distance matrix service
		var service = new google.maps.DistanceMatrixService();
		origin1 = document.getElementById('from').value;
		destinationA = document.getElementById('to').value;
		service.getDistanceMatrix({
			origins : [ origin1 ],
			destinations : [ destinationA ],
			travelMode : google.maps.TravelMode.DRIVING,
			unitSystem : google.maps.UnitSystem.METRIC,
			avoidHighways : false,
			avoidTolls : false
		}, callback);
	}

	// Hàm được gọi sau khi calculateDistances thực hiện xong và trả về kết quả response và status
	function callback(response, status) {
		// Nếu kết quả trả về với status không phải = OK
		if (status != google.maps.DistanceMatrixStatus.OK) {
			// Báo lỗi
			alert('Error was: ' + status);
		} else {

			// Lấy các địa chỉ đi từ
			var origins = response.originAddresses;
			// Lấy các địa chỉ đến
			var destinations = response.destinationAddresses;
			var outputDiv = document.getElementById('outputDiv');
			outputDiv.innerHTML = '';
			deleteOverlays();
			// Duyệt danh sách địa chỉ đi từ
			for (var i = 0; i < origins.length; i++) {
				// Lấy kết quả ứng với danh sách đi từ
				var results = response.rows[i].elements;
				addMarker(origins[i], false);
				// Với mỗi danh sách địa chỉ đi đến ứng với địa chỉ đi từ thứ i
				for (var j = 0; j < results.length; j++) {
					addMarker(destinations[j], true);
					// Xuất kết quả
					outputDiv.innerHTML += origins[i] + ' đến '
							+ destinations[j] + ': ' + results[j].distance.text
							+ ' trong ' + results[j].duration.text + '<br>';
				}
			}
		}
	}

	function addMarker(location, isDestination) {
		var icon;
		if (isDestination) {
			icon = destinationIcon;
		} else {
			icon = originIcon;
		}
		geocoder.geocode({
			'address' : location
		}, function(results, status) {
			if (status == google.maps.GeocoderStatus.OK) {
				bounds.extend(results[0].geometry.location);
				map.fitBounds(bounds);
				var marker = new google.maps.Marker({
					map : map,
					position : results[0].geometry.location,
					icon : icon
				});
				markersArray.push(marker);
			} else {
				alert('Geocode was not successful for the following reason: '
						+ status);
			}
		});
	}

	function deleteOverlays() {
		if (markersArray) {
			for (i in markersArray) {
				markersArray[i].setMap(null);
			}
			markersArray.length = 0;
		}
	}
</script>
</head>
<body onload="initialize()">
	<div id="inputs">
		Đi từ: <input type="text" id="from" /> Đi đến: <input type="text"
			id="to" /><br />
		<p>
			<button type="button" onclick="calculateDistances2();">Tính
				khoảng cách 2</button>
		</p>

		<p>
			<button type="button" onclick="calculateDistances();">Tính
				khoảng cách</button>
		</p>
	</div>
	<div id="outputDiv"></div>
	<div id="map"></div>
</body>
</html>