<!DOCTYPE html>
<html>
<head>
<title>Place Autocomplete</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<meta charset="utf-8">
<style>
html, body {
	height: 100%;
	margin: 0;
	padding: 0;
}

#map {
	height: 100%;
}

.controls {
	margin-top: 10px;
	border: 1px solid transparent;
	border-radius: 2px 0 0 2px;
	box-sizing: border-box;
	-moz-box-sizing: border-box;
	height: 32px;
	outline: none;
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
}

#origin-input, #destination-input {
	background-color: #fff;
	font-family: Roboto;
	font-size: 15px;
	font-weight: 300;
	margin-left: 12px;
	padding: 0 11px 0 13px;
	text-overflow: ellipsis;
	width: 200px;
}

#origin-input:focus, #destination-input:focus {
	border-color: #4d90fe;
}

#mode-selector {
	color: #fff;
	background-color: #4d90fe;
	margin-left: 12px;
	padding: 5px 11px 0px 11px;
}

#mode-selector label {
	font-family: Roboto;
	font-size: 13px;
	font-weight: 300;
}
</style>

<script>
	// This example requires the Places library. Include the libraries=places
	// parameter when you first load the API. For example:
	// <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">
	var origin_place_id = null;
	var destination_place_id = null;
	var map = null;
	var infowindow;
	function errorHandler(err) {
		if (err.code == 1) {
			alert("Error: Access is denied!");
		} else if (err.code == 2) {
			alert("Error: Position is unavailable!");
		}
	}
	function getLocation() {
		if (navigator.geolocation) {
			// timeout at 60000 milliseconds (60 seconds)
			var options = {
				timeout : 60000
			};
			navigator.geolocation.getCurrentPosition(initMap,
					errorHandler, options);
		} else {
			alert("Sorry, browser does not support geolocation!");
		}
	}
	function callback(results, status) {
		if (status == google.maps.places.PlacesServiceStatus.OK) {
			for (var i = 0; i < results.length; i++) {
				// Duyệt từng địa điểm và đánh dấu lên bản đồ
				createMarker(results[i]);
			}
		}
	}
	// Hàm đánh dấu lên bản đồ từ 1 đối tượng địa điểm place
	function createMarker(place) {
		var placeLoc = place.geometry.location;
		var marker = new google.maps.Marker({
			map : map,
			position : place.geometry.location
		});
		google.maps.event.addListener(marker, 'click', function() {
			infowindow.setContent(place.name);
			infowindow.open(map, this);
		});
	}
	function initMap(position) {
		var travel_mode = google.maps.TravelMode.WALKING;
		var latitude = position.coords.latitude;
		var longitude = position.coords.longitude;
		var pyrmont = new google.maps.LatLng(latitude, longitude);
		// khởi tạo bản đồ vào div#map
		map = new google.maps.Map(document.getElementById('map'), {
			mapTypeId : google.maps.MapTypeId.TERRAIN,
			// ROADMAP displays the normal, default 2D tiles of Google Maps.
			// SATELLITE displays photographic tiles.
			// HYBRID displays a mix of photographic tiles and a tile layer for prominent features (roads, city names).
			// TERRAIN displays physical relief tiles for displaying elevation and water features (mountains, rivers, etc.).
			mapTypeControl : false,
			center : pyrmont,
			zoom : 14
		// Zoom hiện tại
		});
		infowindow = new google.maps.InfoWindow();
		// Tạo make hiển thị địa điểm của bạn
		var marker1 = new google.maps.Marker({
		     position : pyrmont,
		});
		infowindow.setContent("Bạn đang ở đây!");
		infowindow.open(map, marker1);
		google.maps.event.addListener(marker1, 'click', function() {
			infowindow.setContent("Bạn ở đây!");
			infowindow.open(map, this);
		});
		marker1.setMap(map);
		// Tạo đối tượng request
		var request = {
			location : pyrmont, // Tìm từ vị trí trung tâm
			radius : 50000, // Bán kính 500m
			types : [ 'hospital' ]
		// Tìm tất cả nhà hàng
		};
		// Hiển thị thông tin về địa điểm
		infowindow = new google.maps.InfoWindow();
		var service = new google.maps.places.PlacesService(map);
		// Thực hiện gọi hàm nearbySearch để tìm những atm lân cận và trả về thực hiện
		// hàm callback
		service.nearbySearch(request, callback);
		
		var directionsService = new google.maps.DirectionsService;
		var directionsDisplay = new google.maps.DirectionsRenderer;
		directionsDisplay.setMap(map);

		var origin_input = document.getElementById('origin-input');
		var destination_input = document.getElementById('destination-input');

		map.controls[google.maps.ControlPosition.TOP_LEFT].push(origin_input);
		map.controls[google.maps.ControlPosition.TOP_LEFT]
				.push(destination_input);

		var origin_autocomplete = new google.maps.places.Autocomplete(
				origin_input);
		origin_autocomplete.bindTo('bounds', map);
		var destination_autocomplete = new google.maps.places.Autocomplete(
				destination_input);
		destination_autocomplete.bindTo('bounds', map);

		// Sets a listener on a radio button to change the filter type on Places
		var marker = new google.maps.Marker({
			map : map,
			animation:google.maps.Animation.BOUNCE
		});

		function expandViewportToFitPlace(map, place) {
			if (place.geometry.viewport) {
				map.fitBounds(place.geometry.viewport);
			} else {
				map.setCenter(place.geometry.location);
				map.setZoom(12);
			}
		}

		origin_autocomplete
				.addListener(
						'place_changed',
						function() {
							var place = origin_autocomplete.getPlace();
							if (!place.geometry) {
								window
										.alert("Autocomplete's returned place contains no geometry");
								return;
							}
							expandViewportToFitPlace(map, place);

							marker.setPlace({
								placeId : place.place_id,
								location : place.geometry.location
							});
							marker.setVisible(true);

							// If the place has a geometry, store its place ID and route if we have
							// the other place ID
							origin_place_id = place.place_id;
							route(origin_place_id, destination_place_id,
									travel_mode, directionsService,
									directionsDisplay);
						});

		destination_autocomplete
				.addListener(
						'place_changed',
						function() {
							var place = destination_autocomplete.getPlace();
							if (!place.geometry) {
								window
										.alert("Autocomplete's returned place contains no geometry");
								return;
							}
							expandViewportToFitPlace(map, place);

							marker.setPlace({
								placeId : place.place_id,
								location : place.geometry.location
							});
							marker.setVisible(true);

							// If the place has a geometry, store its place ID and route if we have
							// the other place ID
							destination_place_id = place.place_id;
							route(origin_place_id, destination_place_id,
									travel_mode, directionsService,
									directionsDisplay);
						});

		function route(origin_place_id, destination_place_id, travel_mode,
				directionsService, directionsDisplay) {
			if (!origin_place_id || !destination_place_id) {
				return;
			}
			directionsService.route({
				origin : {
					'placeId' : origin_place_id
				},
				destination : {
					'placeId' : destination_place_id
				},
				travelMode : travel_mode
			}, function(response, status) {
				if (status === google.maps.DirectionsStatus.OK) {
					directionsDisplay.setDirections(response);
				} else {
					window.alert('Directions request failed due to ' + status);
				}
			});
		}
	}
</script>
<script
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDanVTriVyYbvbkp7c8RPD7O1SOuKo8aK4&libraries=places"
	async defer></script>
</head>
<body onload="getLocation();">
	<input id="origin-input" class="controls" type="text"
		placeholder="Enter an origin location">

	<input id="destination-input" class="controls" type="text"
		placeholder="Enter a destination location">

	<div id="map"></div>
</body>
</html>